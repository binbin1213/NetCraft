# 家庭网络架构设计指南

一个科学、合理的网络架构是家庭网络稳定运行的基础。本指南将介绍几种主流的家庭网络拓扑结构及其适用场景。

## 1. 核心原则

1. **光猫桥接 (Bridge Mode)**：
   强烈建议联系运营商将光猫改为“桥接模式”，由高性能的主路由器进行 PPPoE 拨号。光猫自带的路由功能通常性能较弱，且 NAT 表较小，容易导致连接数受限。

2. **单一 NAT (Single NAT)**：
   避免多层路由嵌套（多层 NAT），这会导致端口转发困难、UPnP 失效以及网络延迟增加。所有设备应尽量处于同一个局域网段（如 `192.168.1.x`）。

3. **有线回程 (Ethernet Backhaul)**：
   如果使用 Mesh 组网，务必使用网线连接各个节点（有线回程），无线回程的损耗极大。

---

## 2. 推荐拓扑结构

### 2.1 方案 A：高性能主路由 + AP (推荐)
适合大多数极客和高性能需求用户。

- **结构**：光猫 (桥接) -> **软路由/硬路由 (主拨号)** -> 交换机 -> 无线 AP / Mesh 节点 (AP 模式)
- **优点**：
  - 主路由专注于数据转发和插件运行（OpenClash, AdGuard Home）。
  - AP 专注于无线信号覆盖，互不干扰。
  - 扩展性极强。

### 2.2 方案 B：旁路由 (单臂路由)
适合不想改动现有主路由配置，只想增加翻墙/去广告功能的用户。

- **结构**：光猫 -> 主路由 -> **旁路由 (N1/树莓派)**
- **配置关键**：
  - 旁路由关闭 DHCP。
  - 需要翻墙的设备，网关和 DNS 指向旁路由 IP。
  - 或者主路由 DHCP 下发的网关指向旁路由（全屋接管）。
- **缺点**：流量在内网“绕路”，占用主路由与旁路由之间的带宽；配置不当容易出现 NAT 环回问题。

---

## 3. IP 地址与子网规划

建议为网络设备规划固定的 IP 地址，便于管理和维护。

| 设备类型 | 推荐 IP 范围 | 示例 |
| :--- | :--- | :--- |
| **网络核心** | .1 - .10 | 主路由 (192.168.1.1), 旁路由 (192.168.1.2) |
| **网络设施** | .11 - .20 | 交换机, AP 控制器 |
| **服务器/NAS** | .21 - .50 | 群晖 NAS, PVE, ESXi |
| **DHCP 动态分配** | .100 - .200 | 手机, 平板, 笔记本 |
| **智能家居** | .201 - .250 | 网关, 摄像头, 智能插座 |

---

## 4. VLAN 划分 (进阶)

对于有安全需求的用户，可以通过 VLAN 将不可信设备隔离。

- **VLAN 1 (Default)**: 家庭主网络，所有可信设备。
- **VLAN 10 (IoT)**: 智能家居设备。禁止访问 VLAN 1，仅允许访问 WAN。
- **VLAN 20 (Guest)**: 访客网络。隔离内网，仅允许上网。

**实现前提**：需要支持 802.1Q VLAN 的交换机和支持 VLAN 的 AP。
